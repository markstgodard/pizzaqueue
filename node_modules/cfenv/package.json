{
  "name": "cfenv",
  "main": "./lib/cfenv",
  "description": "easy access to your Cloud Foundry application environment",
  "version": "1.0.0",
  "author": {
    "name": "pmuellr"
  },
  "license": "Apache-2.0",
  "homepage": "https://github.com/cloudfoundry-community/node-cfenv",
  "repository": {
    "type": "git",
    "url": "https://github.com/cloudfoundry-community/node-cfenv.git"
  },
  "dependencies": {
    "js-yaml": "3.2.x",
    "ports": "1.1.x",
    "underscore": "1.7.x"
  },
  "devDependencies": {
    "coffee-script": "1.8.x",
    "mocha": "1.21.x",
    "expect.js": "0.3.x"
  },
  "scripts": {
    "start": "node server.js"
  },
  "readme": "cfenv - easy access to your Cloud Foundry application environment\n================================================================================\n\nThe cfenv package provides functions to parse Cloud Foundry-provided environment\nvariables.  Provides easy access to your port, http\nbinding host name/ip address, URL of the application, etc.  Also provides\nuseful default values when you're running locally.\n\nThe package determines if you are running \"locally\" versus running as a\nCloud Foundry app, based on whether the `VCAP_APPLICATION` environment variable is set.\nIf not set, the functions run in \"local\" mode, otherwise they run in \"cloud\"\nmode.\n\n\n\nquick start\n================================================================================\n\n    var cfenv = require(\"cfenv\")\n\n    var appEnv = cfenv.getAppEnv()\n    ...\n    // start the server on the given port and binding host, and print\n    // url to server when it starts\n\n    server.listen(appEnv.port, appEnv.bind, function() {\n        console.log(\"server starting on \" + appEnv.url)\n    })\n\nThis code snippet above will get the port, binding host, and full URL to your HTTP\nserver and use them to bind the server and print the server URL when starting.\n\n\n\nrunning in Cloud Foundry vs locally\n================================================================================\n\nThis package makes use of a number of environment variables that are set when\nyour application is running in Cloud Foundry.  These include:\n\n* `VCAP_SERVICES`\n* `VCAP_APPLICATION`\n* `PORT`\n\nIf these aren't set, the `getAppEnv()` API will still return useful values,\nas appropriate.  This means you can use this package in your program and\nit will provide useful values when you're running in Cloud Foundry AND\nwhen you're running locally.\n\n\n\napi\n================================================================================\n\nThe `cfenv` package exports the following function:\n\n\n\n`getAppEnv(options)`\n--------------------------------------------------------------------------------\n\nGet the core bits of Cloud Foundry data as an object.\n\nThe `options` parameter is optional, and can contain the following properties:\n\n* `name` - name of the application\n\n  This value is used as the default `name` property of the returned object,\n  and as the name passed to\n  [the ports package `getPort()` function](https://www.npmjs.org/package/ports)\n  to get a default port.\n\n  If not specified, the name will looked for in the following places:\n\n  * the `name` property of the `VCAP_APPLICATION` environment variable\n  * the `name` property from the `manifest.yml` file in the current directory\n  * the `name` property from the `package.json` file in the current directory\n\n* `protocol` - protocol used in the generated URLs\n\n  This value is to override the default protocol used when generating\n  the URLs in the returned object.  It should be the same format as\n  [node's url `protocol` property](http://nodejs.org/api/url.html).\n  That is, it should end with a `:` character.\n\n* `vcap` - provide values for the `VCAP_APPLICATION` and `VCAP_SERVICES`\n  environment variable, when running locally.  The object can have\n  properties `application` and/or `services`, whose values are the same\n  as the values serialized in the respective environment variables.\n\n  Note that the `url` and `urls` properties of the returned object are not\n  based on the vcap `application` object, when running locally.\n\n  This option property is ignored if not running locally.\n\nThis function returns an object with the following properties:\n\n* `app`:      object version of `VCAP_APPLICATION` env var\n* `services`: object version of `VCAP_SERVICES` env var\n* `name`:     name of the application\n* `port`:     HTTP port\n* `bind`:     hostname/ip address for binding\n* `urls`:     URLs used to access the servers\n* `url`:      first URL in `urls`\n* `isLocal`:  true if a valid `VCAP_APPLICATION` env var was found, false otherwise\n\nThe returned object also has the following methods available:\n\n* `appEnv.getServices()`\n* `appEnv.getService(spec)`\n* `appEnv.getServiceURL(spec, replacements)`\n* `appEnv.getServiceCreds(spec)`\n\nIf no value can be determined for `port`, and the `name` property on the\n`options` parameter is not set and cannot be determined,\na port of 3000 will be used.\n\nIf no value can be determined for `port`, and the `name` property on the\n`options` parameter is set or can otherwise be determined,\nthat name will be passed to\n[the ports package `getPort()` function](https://www.npmjs.org/package/ports)\nto get a default port.\n\nThe protocol used for the URLs will be `http:` if the app\nis running locally, and `https:` otherwise; you can\nforce a particular protocol by using the `protocol` property\non the `options` parameter.\n\n\n\nAppEnv methods\n--------------------------------------------------------------------------------\n\nThe following methods are also available on the object returned by\n`cfenv.getAppEnv()`.\n\n\n\n**`appEnv.getServices()`**\n--------------------------------------------------------------------------------\n\nReturn all services, in an object keyed by service name.\n\nNote that this is different than the `services` property\nreturned from `getAppEnv()`.\n\nFor example, assume VCAP_SERVICES was set to the following:\n\n    {\n        \"user-provided\": [\n            {\n                \"name\": \"cfenv-test\",\n                \"label\": \"user-provided\",\n                \"tags\": [],\n                \"credentials\": {\n                    \"database\": \"database\",\n                    \"password\": \"passw0rd\",\n                    \"url\": \"https://example.com/\",\n                    \"username\": \"userid\"\n                },\n                \"syslog_drain_url\": \"http://example.com/syslog\"\n            }\n        ]\n    }\n\nIn this case, `appEnv.services` would be set to that same object, but\n`appEnv.getServices()` would return\n\n    {\n        \"cfenv-test\": {\n            \"name\": \"cfenv-test\",\n            \"label\": \"user-provided\",\n            \"tags\": [],\n            \"credentials\": {\n                \"database\": \"database\",\n                \"password\": \"passw0rd\",\n                \"url\": \"https://example.com/\",\n                \"username\": \"userid\"\n            },\n            \"syslog_drain_url\": \"http://example.com/syslog\"\n        }\n    }\n\n\n**`appEnv.getService(spec)`**\n--------------------------------------------------------------------------------\n\nReturn a service object by name.\n\nThe `spec` parameter should be a regular expression, or a string which is the\nexact name of the service.  For a regular expression, the first service name\nwhich matches the regular expression will be returned.\n\nReturns the service object from VCAP_SERVICES or null if not found.\n\n\n\n**`appEnv.getServiceURL(spec, replacements)`**\n--------------------------------------------------------------------------------\n\nReturns a service URL by name.\n\nThe `spec` parameter should be a regular expression, or a string which is the\nexact name of the service.  For a regular expression, the first service name\nwhich matches the regular expression will be returned.\n\nThe `replacements` parameter is an object with the properties used in\n[node's url function `url.format()`](http://nodejs.org/api/url.html#url_url_format_urlobj).\n\nReturns a URL generated from VCAP_SERVICES or null if not found.\n\nTo generate the URL, processing first starts with a `url` property\nin the service credentials.  You can override the `url` property in the\nservice credentials (if no such property exists), with a `replacements`\nproperty of `url`, and a value which is the name of the property in\nthe service credentials whose value contains the base URL.\n\nThat url is parsed with\n[node's url function `url.parse()`](http://nodejs.org/api/url.html#url_url_parse_urlstr_parsequerystring_slashesdenotehost)\nto get a set of initial url properties.\nThese properties are then overridden by entries in `replacements`, using the\nfollowing operation, for a given replacement `key` and `value`.\n\n     url[key] = service.credentials[value]\n\nThe URL `auth` replacement is a bit special, in that it's value should\nbe a two-element array of [userid, password], where those values are\nkeys in the service.credentials\n\nFor example, assume VCAP_SERVICES was set to the following:\n\n    {\n        \"user-provided\": [\n            {\n                \"name\": \"cfenv-test\",\n                \"label\": \"user-provided\",\n                \"tags\": [],\n                \"credentials\": {\n                    \"database\": \"database\",\n                    \"password\": \"passw0rd\",\n                    \"url\": \"https://example.com/\",\n                    \"username\": \"userid\"\n                },\n                \"syslog_drain_url\": \"http://example.com/syslog\"\n            }\n        ]\n    }\n\nAssume you run the following code:\n\n    url = appEnv.getServiceURL(\"cfenv-test\", {\n        pathname: \"database\",\n        auth:     [\"username\", \"password\"]\n    })\n\nThe `url` result will be `https://userid:passw0rd@example.com/database`\n\nNote that there **MUST** be a `url` property in the credentials,\nor replacement for it, in the\nservice, or the call will return `null`.  Also, because the `url` is parsed\nfirst with `url.parse()`, there will be a `host` property in the result, so\nyou won't be able to use the `hostname` and `port` values directly.  You\ncan **ONLY** set the resultant hostname and port with the `host` property.\n\nSince the `appEnv.getServiceURL()` method operates against the\n`appEnv.services` property, you can fudge this object if that makes your\nlife easier.\n\n**`appEnv.getServiceCreds(spec)`**\n--------------------------------------------------------------------------------\n\nReturns the `credentials` object of a service by name.\n\nThe `spec` parameter is the same as that used by the `appEnv.getServiceURL()`\nmethod.  If there is no service that matches the `spec` parameter, this method\nwill return `null`.\n\nIf there is a service that matches the `spec` parameter, the value of it's\n`credentials` property will be returned.  If for some reason, there is no\n`credentials` property on the service, an empty object - `{}` - will be\nreturned.\n\n\n\ntesting with Cloud Foundry\n================================================================================\n\nYou can push this project as a Cloud Foundry project to try it out.\n\nFirst, create a service name `cfenv-test` with the following command:\n\n    cf cups cfenv-test -p \"url, username, password, database\"\n\nYou will be prompted for these values; enter something reasonable like:\n\n    url>      http://example.com\n    username> userid\n    password> passw0rd\n    database> the-db\n\nNext, push the app with `cf push`.\n\nWhen you visit the site, you'll see the output of various cfenv calls.\n\n\n\nhacking\n================================================================================\n\nIf you want to modify the source to play with it, you'll also want to have the\n`jbuild` program installed.\n\nTo install `jbuild` on Windows, use the command\n\n    npm -g install jbuild\n\nTo install `jbuild` on Mac or Linux, use the command\n\n    sudo npm -g install jbuild\n\nThe `jbuild` command runs tasks defined in the `jbuild.coffee` file.  The\ntask you will most likely use is `watch`, which you can run with the\ncommand:\n\n    jbuild watch\n\nWhen you run this command, the application will be built from source, the server\nstarted, and tests run.  When you subsequently edit and then save one of the\nsource files, the application will be re-built, the server re-started, and the\ntests re-run.  For ever.  Use Ctrl-C to exit the `jbuild watch` loop.\n\nYou can run those build, server, and test tasks separately.  Run `jbuild`\nwith no arguments to see what tasks are available, along with a short\ndescription of them.\n\n\n\nlicense\n================================================================================\n\nApache License, Version 2.0\n\n<http://www.apache.org/licenses/LICENSE-2.0.html>\n",
  "readmeFilename": "README.md",
  "bugs": {
    "url": "https://github.com/cloudfoundry-community/node-cfenv/issues"
  },
  "_id": "cfenv@1.0.0",
  "_from": "cfenv@1.0.x"
}
